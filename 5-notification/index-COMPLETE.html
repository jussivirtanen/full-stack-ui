<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../base.css" />
    <title>Notification</title>
    <style>
      /* Your styles here */
      .list {
        list-style-type: none;
        position: absolute;
        top: 1em;
        right: 1em;
      }
      .notification {
        position: absolute;
        right: 1em;
        display: flex;
        padding: 1.5em;
        width: 300px;
        background-color: lightgray;
        transition: var(--transition);
        animation: slide-in 0.5s var(--transition-curve) forwards;
      }
      .close {
        padding: 0.5em;
        margin-left: auto;
      }
      .add {
        padding: 1em;
      }
      .animate-out {
        animation: fade-out 0.5s var(--transition-curve);
      }
      @keyframes fade-out {
        to {
          opacity: 0;
          transform: translateX(300px);
        }
      }
      @keyframes slide-in {
        from {
          transform: translateX(300px);
        }
        to {
          transform: translateX(0);
        }
      }
    </style>
  </head>
  <body>
    <div>
      <button class="add">Add +</button>
    </div>

    <!-- Idea: transform for sideways animations and top for vertical movement (and animation) -->

    <!-- Your JavaScript here -->
    <script>
      const addButton = document.querySelector('.add');
      const notificationPosition = document.body.querySelector('div');
      const margin = 16;

      const addNotification = () => {
        // Create notification
        const notification = document.createElement('div');
        // Add class "notification"
        notification.classList.add('notification');
        // Create random content for notification
        const randomContent = 'lorem ipsum '.repeat(
          Math.floor(Math.random() * 12 + 1)
        );
        // Insert random content and close button
        notification.innerHTML = `
          ${randomContent} <button class="close">x</button>
        `;
        // Get close button within notification
        const closeButton = notification.querySelector('.close');
        // Listen for the button and attach "removeNotification" function to it
        closeButton.addEventListener('click', removeNotification);
        // Position notification
        notification.style.top = `${margin}px`;
        // Add notification on the page
        notificationPosition.prepend(notification);
        // Move other notifications down
        // 1. Get height of the newly added notification
        const currentHeight = notification.offsetHeight;
        // 2. Get the rest of the notifications and turn them into an array
        const restNotifications = Array.from(
          document.querySelectorAll('.notification')
        ).slice(1);
        // 3. Add the currently added notification's height to the rest of the notifications
        restNotifications.forEach((item) => {
          item.style.top = `${
            parseInt(item.style.top) + currentHeight + margin
          }px`;
        });
      };

      const removeNotification = (event) => {
        const closeButton = event.currentTarget;
        const notification = closeButton.parentNode;
        const currentHeight = notification.offsetHeight;
        let restNotifications = [];
        let next = notification.nextElementSibling;
        while (next) {
          restNotifications.push(next);
          next = next.nextElementSibling;
        }
        console.log(restNotifications);
        restNotifications.forEach((item) => {
          item.style.top = `${
            parseInt(item.style.top) - currentHeight - margin
          }px`;
        });
        notification.classList.add('animate-out');
        notification.addEventListener('animationend', () => {
          notification.parentNode.removeChild(notification);
        });
      };

      addButton.addEventListener('click', addNotification);
    </script>
  </body>
</html>
